<div class="container">
  <div class="search-section">
    <div class="search-SucursaF">
      <ng-container *ngIf="isBrowser">
        <p-datepicker  [(ngModel)]="anioSeleccionado"
                    view="year"
                    dateFormat="yy"
                    placeholder="Selecciona el Año"
                    (onSelect)="cargarFechas()">
        </p-datepicker >
      </ng-container>
      <p-select [options]="sucursales"
          [(ngModel)]="sucursalSeleccionada"
          optionLabel="nombre"
          placeholder="Selecciona la Sucursal"
          (onChange)="cargarFechas()">
        </p-select>
    </div>
    <br>
    <div class="search-SucursaF">

    <ng-container *ngIf="isBrowser">
            <p-datepicker [(ngModel)]="fechaInicio" [showIcon]="true" placeholder="Fecha Inicio" [inline]="false">
        <ng-template pTemplate="date" let-date>
            <div [ngClass]="obtenerClaseParaFecha(date)">{{ date.day }}</div>
        </ng-template>
    </p-datepicker>

    <p-datepicker [(ngModel)]="fechaFin" [showIcon]="true" placeholder="Fecha Fin" [inline]="false">
        <ng-template pTemplate="date" let-date>
            <div [ngClass]="obtenerClaseParaFecha(date)">{{ date.day }}</div>
        </ng-template>
    </p-datepicker>
        <p-select
        [options]="listaDeEstados"
        [(ngModel)]="estadoSeleccionado"
        placeholder="Filtrar por Estado"
        [showClear]="true">
    </p-select>
    </ng-container>



  </div>
  <div class="search-button">
        <button pButton type="button" label="Buscar" id="btnBuscar" icon="pi pi-search" class="p-button-primary" (click)="buscarRegistros()"></button>
  </div>


  </div>


  <div class="search-section">

  </div>

  <p-table [value]="data" [paginator]="true"
    [rows]="tamanioPagina"
    [totalRecords]="totalRegistros"
    (onPage)="onPageChange($event)" styleClass="p-datatable-striped">
    <ng-template pTemplate="header">
      <tr>
        <th>Comprobante</th>
        <th>Documento</th>
        <th>Archivo</th>
        <th>Fecha de Caja</th>
        <th>Comentario Cargador</th>
        <th>Comentario</th>
        <th>Ingresado Por</th>
        <th>Estado</th>
        <th>Acción</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td>{{item.numeroComprobante}}</td>
        <td>{{item.documento}}</td>
        <td>
          <button pButton type="button" class="p-button-rounded p-button-info"[loading]="loading"[disabled]="loading"
                  (click)="mostrarPDF(item)"><mat-icon aria-hidden="false" aria-label="icon" fontIcon="download"></mat-icon>
          </button>
        </td>
        <td>{{item.fechaCarga | date}}</td>
        <td>{{item.comentarioCargador}}</td>
        <td>
            <input pInputText type="text" [(ngModel)]="item.comentario">
        </td>
        <td>{{item.usuario}}</td>
        <td>
          <p-tag
            [value]="item.estado"
            [severity]="item.estado === 'Aprobado' ? 'success' : item.estado === 'Rechazado' ? 'danger' : 'info'">
          </p-tag>
        </td>
        <td>
          <button type="button" class="aceptarCaja"
            [ngClass]="{'disabled-button': item.estado === 'Aprobado' || item.estado === 'Aceptado' || item.estado === 'Rechazado'}"
            [disabled]="loading || item.estado === 'Aprobado'|| item.estado === 'Aceptado' || item.estado === 'Rechazado'"
            (click)="cambiarEstado(item, 'Aceptado')">
            <mat-icon aria-hidden="false" aria-label="icon" fontIcon="check_circle"></mat-icon>
          </button>

          <button type="button" class="rechazarCaja"
            [ngClass]="{'disabled-button': item.estado === 'Aprobado' || item.estado === 'Aceptado' || item.estado === 'Rechazado'}"
            [disabled]="loading || item.estado === 'Aprobado'|| item.estado === 'Aceptado' || item.estado === 'Rechazado'"
            (click)="cambiarEstado(item, 'Rechazado')">
            <mat-icon aria-hidden="false" aria-label="icon" fontIcon="cancel"></mat-icon>
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog header="Visualizar PDF" [modal]="true" [(visible)]="visible" [style]="{ width: '95%', height: '100%' }">
    <object *ngIf="pdfUrl" [data]="pdfUrl" type="application/pdf" width="100%" height="100%">
      Tu navegador no soporta PDFs. <a [href]="pdfUrl" target="_blank">Haz clic aquí para ver el archivo.</a>
    </object>
  </p-dialog>
</div>
