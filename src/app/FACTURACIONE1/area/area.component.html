<div class="card">
    <p-toast />
    <p-confirmDialog />

    <!-- Toolbar -->
    <p-toolbar styleClass="mb-4 gap-2">
        <ng-template pTemplate="left">
            <p-button 
                label="Nueva Área" 
                icon="pi pi-plus" 
                severity="success" 
                (onClick)="openNew()">
            </p-button>
        </ng-template>
    </p-toolbar>

    <!-- Tabla Lazy -->
    <p-table 
        #dt
        [value]="areas" 
        [lazy]="true"
        (onLazyLoad)="loadAreas($event)"
        [totalRecords]="totalRecords"
        [loading]="loading"
        [rows]="10" 
        [paginator]="true" 
        [rowsPerPageOptions]="[5, 10, 20]"
        [tableStyle]="{ 'min-width': '60rem' }"
        [rowHover]="true"
        dataKey="id"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} áreas"
        [showCurrentPageReport]="true">
        
        <ng-template pTemplate="header">
            <tr>
                <!-- COLUMNA NOMBRE -->
                <th>
                    <div class="flex flex-column gap-2">
                        <span class="font-bold">Nombre</span>
                        <input 
                            pInputText 
                            type="text" 
                            class="w-full p-inputtext-sm"
                            placeholder="Buscar Nombre" 
                            (input)="onFilterInput($event, 'nombre')" />
                    </div>
                </th>

                <!-- COLUMNA CÓDIGO -->
                <th>
                    <div class="flex flex-column gap-2">
                        <span class="font-bold">Código</span>
                        <input  
                            pInputText 
                            type="text" 
                            class="w-full p-inputtext-sm"
                            placeholder="Buscar Código" 
                            (input)="onFilterInput($event, 'codigo')" />
                    </div>
                </th>

                <!-- COLUMNA ESTADO -->
                <th>
                    <div class="flex flex-column gap-2">
                        <span class="font-bold">Estado</span>
                        <p-select 
                            [options]="estadoFilterOptions" 
                            [(ngModel)]="filtros.estado" 
                            (onChange)="onFilterInput($event, 'estado')"
                            optionLabel="label" 
                            optionValue="value"
                            placeholder="Todos"
                            [showClear]="true">
                        </p-select>
                    </div>
                </th>

                <th style="width: 10rem">Acciones</th>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-item>
            <tr>
                <td>{{ item.nombre }}</td>
                <td>{{ item.codigo || 'N/A' }}</td>
                <td>
                    <p-tag 
                        [value]="item.estado ? 'Activo' : 'Inactivo'" 
                        [severity]="item.estado ? 'success' : 'danger'">
                    </p-tag>
                </td>
                <td>
                    <p-button 
                        icon="pi pi-pencil" 
                        [rounded]="true" 
                        [text]="true" 
                        severity="info" 
                        (onClick)="editArea(item)">
                    </p-button>
                    <p-button 
                        icon="pi pi-trash" 
                        [rounded]="true" 
                        [text]="true" 
                        severity="danger" 
                        (onClick)="deleteArea(item)">
                    </p-button>
                </td>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="4" class="text-center">No se encontraron áreas.</td>
            </tr>
        </ng-template>
    </p-table>

    <!-- DIÁLOGO MODAL -->
    <p-dialog 
        [(visible)]="areaDialog" 
        [style]="{ width: '500px' }" 
        [breakpoints]="{ '960px': '75vw', '640px': '95vw' }"
        header="Detalles del Área" 
        [modal]="true" 
        styleClass="p-fluid"
        [draggable]="false"
        [resizable]="false">
        
        <ng-template pTemplate="content">
            <div class="form-container">
                
                <!-- Nombre -->
                <div class="field">
                    <label for="nombre">Nombre</label>
                    <input 
                        type="text" 
                        pInputText 
                        id="nombre" 
                        [(ngModel)]="area.nombre" 
                        required 
                        autofocus />
                    <small class="p-error" *ngIf="submitted && !area.nombre">
                        El nombre es obligatorio.
                    </small>
                </div>
                <!-- Estado -->
                <div class="field">
                    <label for="estado">Estado</label>
                    <p-select 
                        id="estado"
                        [options]="estadoOptions" 
                        [(ngModel)]="area.estado" 
                        optionLabel="label" 
                        optionValue="value"
                        placeholder="Seleccione estado">
                    </p-select> 
                </div>
                <!-- Código -->
                <div class="field">
                    <label for="codigo">Código</label>
                    <input 
                        type="text" 
                        pInputText 
                        id="codigo" 
                        [(ngModel)]="area.codigo" 
                        placeholder="Ej: ADM01" />
                </div>

                

            </div>
        </ng-template>

        <ng-template pTemplate="footer">
            <div class="dialog-footer">
                <p-button 
                    label="Cancelar" 
                    icon="pi pi-times" 
                    [text]="true" 
                    severity="secondary" 
                    (onClick)="hideDialog()">
                </p-button>
                <p-button 
                    label="Guardar" 
                    icon="pi pi-check" 
                    severity="primary" 
                    (onClick)="saveArea()">
                </p-button>
            </div>
        </ng-template>
    </p-dialog>
</div>